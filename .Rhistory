install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2")
install.packages("ggplot2", dependencies = TRUE, type = "win.binary")
install.packages("rlang")
install.packages("rlang", type = "win.binary", dependencies = "TRUE")
install.packages("rlang"
install.packages("rlang");
install.packages("rlang");
source("D:\\Rcode\\create_dat.R")
#
create.dat(directory="D:\\CORD\\PSE",csv_file_name="PSE_NSA_2020",out_extension="dat",first_col_data=2,col_headers=TRUE)
source("Z:\\People\\Atanaska\\Useful Rcode\\change_mode_ANedit.R")
change.mode(directory="D:\\CORD\\mgdp\\modes",out.mode="BlueBook",in.mode="Live",meta.ext="xml")
source("D:\\Rcode\\change.xml.activity.R")
change.xml.activity(directory="D:\\CORD\\mgdp\\modes", new.code="GDP(O)")
NCMP_data<-read.csv("D:\\SDG general\\DAO stuff\\
National Child Measurement Programme - England 2018-19 CSV File and Guidance\\
ncmp_1819_final_non_disclosive_published.csv")
NCMP_data<-read.csv("D:\\SDG general\\DAO stuff\\National Child Measurement Programme - England 2018-19 CSV File and Guidance\\ncmp_1819_final_non_disclosive_published.csv")
head(NCMP_data)
min(NCMP_data$AgeInMonths)
min(NCMP_data$AgeInMonths)/12
max(NCMP_data$AgeInMonths)/12
nrow(NCMP_data[(NCMP_data$AgeInMonths)/12)==60, ])
nrow(NCMP_data[(NCMP_data$AgeInMonths/12)==60, ])
head(NCMP_data[(NCMP_data$AgeInMonths/12),])
nrow(NCMP_data[NCMP_data$AgeInMonths==60, ])
head(NCMP_data[NCMP_data$AgeInMonths==60, ])
head(NCMP_data[NCMP_data$AgeInMonths==60, NCMP_data$Height])
head(NCMP_data[NCMP_data$AgeInMonths==60, ])
head(NCMP_data[NCMP_data$AgeInMonths==60, 4])
mean(NCMP_data[NCMP_data$AgeInMonths==60, 4])
median(NCMP_data[NCMP_data$AgeInMonths==60, 4])
?mad
median(NCMP_data[NCMP_data$AgeInMonths==60, 4])
mad(NCMP_data[NCMP_data$AgeInMonths==60, 4])
mad(NCMP_data[NCMP_data$AgeInMonths==60, 4],na.rm=T)
sd(NCMP_data[NCMP_data$AgeInMonths==60, 4])
mad_score<-mad(NCMP_data[NCMP_data$AgeInMonths==60, 4],na.rm=T)
med_score<-median(NCMP_data[NCMP_data$AgeInMonths==60, 4])
head(NCMP_data[NCMP_data$AgeInMonths==60, 4])
med_score<-median(NCMP_data[NCMP_data$AgeInMonths==60, 4])[1]
med_score<-median(NCMP_data[NCMP_data$AgeInMonths==60, 4])
head(NCMP_data[NCMP_data$AgeInMonths==60, 4])[1]
(NCMP_data[NCMP_data$AgeInMonths==60, 4])[1]
((NCMP_data[NCMP_data$AgeInMonths==60, 4])[1]-med_score)/mad_score
med_score
head(NCMP_data[NCMP_data$AgeInMonths==60, 4])
head(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$Height<99.9, 4])
head(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$Height<99.9, ])
head(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$HeightZScore<-2, ])
head(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$Height<99.9, ])
head(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$HeightZScore<-2, ])
head(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$HeightZScore< -2, ])
head(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$Height<99.9, ])
nrow(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$Height<99.9, ])
nrow(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$HeightZScore< -2, ])
age_60<-nrow(NCMP_data[NCMP_data$AgeInMonths==60, ])
age_60
deviations_60<-nrow(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$Height<99.9, ])
deviations_60
prevalence_60<-(deviations_60/age_60)*100
prevalence_60
(deviations_60/age_60)
# WHO standards:
head(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$Height<99.9, ])
nrow(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$HeightZScore< -2, ])
100/50
50/100
0.5*100
((nrow(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$HeightZScore< -2, ]))/age_60)*100
prevalence_60<-(deviations_60/age_60)*100
prevalence_60
deviations_60
nrow(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$HeightZScore< -2, ])
age_60
118/5612
97/5612
-999 < -986
-999 > -986
# clean up suppressions from dataset
nrow(NCMP_data)
clean_NCMP <- NCMP_data[NCMP_data$Height > 0, ]
nrow(clean_NCMP)
nrow(clean_NCMP)-nrow(NCMP_data)
head(NCMP_data)
nrow(clean_NCMP)-nrow(NCMP_data)
age_60
nrow(clean_NCMP[clean_NCMP$AgeInMonths==60, ])
nrow(clean_NCMP[clean_NCMP$AgeInMonths==60, ])-5612
age_60<-nrow(clean_NCMP[clean_NCMP$AgeInMonths==60, ])
prevalence_60
age_60<-nrow(clean_NCMP[clean_NCMP$AgeInMonths==60, ]) #27 suppressed instances
# WHO standards:
head(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$Height<99.9, ])
deviations_60<-nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$Height<99.9, ])
prevalence_60<-(deviations_60/age_60)*100 #1.73% before cleaning
prevalence_60
prevalence_60-1.73
# for comparison with pre-calculated SD from NCMP:
head(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$HeightZScore< -2, ])
nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$HeightZScore< -2, ])
deviations_60
deviations_60
nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$HeightZScore< -2, ])
# prevalence based on pre-calculated SD (a bit larger)
((nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$HeightZScore< -2, ]))/age_60)*100
# WHO standards:
head(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$Height<99.9, ])
deviations_60_f
deviations_60
age_60_f <-nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2, ])
age_60_f
age_60
(deviations_60/age_60)*100
prevalence_60_f<-(deviations_60_f/age_60_f)*100 #1.73% before cleaning vs 1.25% after cleaning (~0.48% difference)
deviations_60_f<-nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$Height<99.9, ])
prevalence_60_f<-(deviations_60_f/age_60_f)*100 #1.73% before cleaning vs 1.25% after cleaning (~0.48% difference)
prevalence_60_f
# for comparison with pre-calculated SD from NCMP:
head(clean_NCMP[clean_NCMP$AgeInMonths==60 clean_NCMP$GenderCode==2 & clean_NCMP$HeightZScore< -2, ])
# for comparison with pre-calculated SD from NCMP:
head(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$HeightZScore< -2, ])
nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$HeightZScore< -2, ])
# prevalence based on pre-calculated SD (a bit larger)
((nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$HeightZScore< -2, ]))/age_60_f)*100
prevalence_60_f
deviations_60_f
nrow(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$Height<99.9, ])
clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$Height<99.9, ]
prevalence_60_f<-(deviations_60_f/age_60_f)*100
prevalence_60_f
nrow(clean_NCMP)-nrow(NCMP_data)
nrow(clean_NCMP)-nrow(NCMP_data) # N supressed height instances
age_60_f
age_60_f
age_60_f_ <-nrow(NCMP_data[NCMP_data$AgeInMonths==60 & NCMP_data$GenderCode==2, ])
age_60_f_
age_60_f_ - age_60_f
prevalence_60_f
deviations_60_f
# WHO standards (?):
head(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$Height<99.9, ])
# WHO standards (?):
colnames(clean_NCMP[clean_NCMP$AgeInMonths==60 & clean_NCMP$GenderCode==2 & clean_NCMP$Height<99.9, ])
install.packages("knitr",dependencies=TRUE, type="win.binary")
library(knitr)
install.packages("tidyverse",dependencies=TRUE, type="win.binary")
library(tidyverse)
getwd()
utils::getSrcFilename
rstudioapi::getActiveDocumentContext()$path
rstudioapi::getActiveDocumentContext()
utils::getSrcFilename
getSrcDirectory()[1]
getSrcFilename()[1]
getSrcFilename(RUN_ME_stunting.R)[1]
getwd()
setwd("D:\\SDG general\\DAO stuff\\NCMP\\NCMP_Rcode")
# example calls
#
# assuming the data csv is one level up from the current working directory:
data_201819<-read.csv("../ncmp_1819_final_non_disclosive_published.csv")
# reading the data from 2018-19 download of the zipped file from NHS Digital, after extracting
# assuming the data csv is one level up from the current working directory
NCMP_data<-read.csv("../ncmp_1819_final_non_disclosive_published.csv")
head(NCMP_data)
# rounding the age in months variable (to match WHO tables better)
NCMP_data$AgeInMonths<-trunc(NCMP_data$AgeInMonths) #this truncates to the integer value, so similar to age in years rounding
head(NCMP_data)
# clean up suppressions from dataset (may need to be more sophisticated, here just removing all negatives)
# this will not be necessary when working with full data set!
clean_NCMP <- NCMP_data[NCMP_data$Height > 0, ]
nrow(clean_NCMP)-nrow(NCMP_data) # N supressed height instances altogether
# retaining only age groups of interest (under 5s, exclusing 5)
clean_NCMP <- clean_NCMP[clean_NCMP$AgeInMonths<60, ]
# extract the unique ages in months (12 months in total, as we only have age 4)
ages<- sort(unique(clean_NCMP$AgeInMonths))
ages
# loading the WHO standards (should be in the current working directory)
who_girls <- read.csv("./height-for-age-(z-scores)-f.csv", header = T)
who_boys <- read.csv("./height-for-age-(z-scores)-m.csv", header = T)
# 1=boys and 2=girls in NCMP data; creating separate tables for each:
NCMP_girls<-clean_NCMP[clean_NCMP$GenderCode==2, ]
NCMP_boys<-clean_NCMP[clean_NCMP$GenderCode==1, ]
# appending the -2SD cut-off from the WHO standards table to the NCMP tables
NCMP_girls$WHO_SD <- who_girls$min2.SD[match(NCMP_girls$AgeInMonths,who_girls$Months)]
NCMP_boys$WHO_SD <- who_boys$min2.SD[match(NCMP_boys$AgeInMonths,who_boys$Months)]
head(NCMP_boys)
# integrating the above test run, but in a loop for girls, using the ages variable:
# initiating an empty variables to hold the results
deviations_girls <- NULL
prevalence_girls <- NULL
instances_girls <- NULL
ages
deviations_girls
i<-48
i
total_age_temp<-nrow(NCMP_girls[NCMP_girls$AgeInMonths==i, ])
total_age_temp
deviations_temp<-nrow(NCMP_girls[NCMP_girls$AgeInMonths==i & NCMP_girls$Height < NCMP_girls$WHO_SD, ])
deviations_temp
prevalence_temp<-(deviations_temp/total_age_temp)*100
prevalence_temp
deviations_girls<-c(deviations_girls,deviations_temp)
prevalence_girls<-c(prevalence_girls,prevalence_temp)
instances_girls<-c(instances_girls,total_age_temp)
deviations_girls
prevalence_girls
instances_girls
i
# integrating the above test run, but in a loop for girls, using the ages variable:
# initiating an empty variables to hold the results
deviations_girls <- NULL
prevalence_girls <- NULL
instances_girls <- NULL
#main loop
for(i in ages){
total_age_temp<-nrow(NCMP_girls[NCMP_girls$AgeInMonths==i, ])
deviations_temp<-nrow(NCMP_girls[NCMP_girls$AgeInMonths==i & NCMP_girls$Height < NCMP_girls$WHO_SD, ])
prevalence_temp<-(deviations_temp/total_age_temp)*100
deviations_girls<-c(deviations_girls,deviations_temp)
prevalence_girls<-c(prevalence_girls,prevalence_temp)
instances_girls<-c(instances_girls,total_age_temp)
}
deviations_girls
prevalence_girls
instances_girls
#formtting final table for girls with detailed results for age
girls_table<-rbind(instances_girls,deviations_girls,prevalence_girls)
colnames(girls_table)<-ages
girls_table
# global prevalence for under 5s girls (i.e. for 4 year olds)
prevalence_under5_girls <- (sum(girls_table["deviations_girls", ])/sum(girls_table["instances_girls", ]))*100
prevalence_under5_girls
# same procedure, but for boys
deviations_boys <- NULL
prevalence_boys <- NULL
instances_boys <- NULL
#main loop
for(i in ages){
total_age_temp<-nrow(NCMP_boys[NCMP_boys$AgeInMonths==i, ])
deviations_temp<-nrow(NCMP_boys[NCMP_boys$AgeInMonths==i & NCMP_boys$Height < NCMP_boys$WHO_SD, ])
prevalence_temp<-(deviations_temp/total_age_temp)*100
deviations_boys<-c(deviations_boys,deviations_temp)
prevalence_boys<-c(prevalence_boys,prevalence_temp)
instances_boys<-c(instances_boys,total_age_temp)
}
#formtting final table for girls with detailed results for age
boys_table<-rbind(instances_boys,deviations_boys,prevalence_boys)
colnames(boys_table)<-ages
boys_table
# global prevalence for under 5s girls (i.e. for 4 year olds)
prevalence_under5_boys <- (sum(boys_table["deviations_boys", ])/sum(boys_table["instances_boys", ]))*100
prevalence_under5_boys
prevalence_under5_boys
prevalence_AgeSex <- rbind(girls_table, boys_table)
prevalence_AgeSex
# Is it normal that there are incrementally more observations as age increases??
# Is it normal there are so few observations of the youngest age group?
barplot(prevalence_AgeSex["instances_girls",], main="Number of girls per age")
barplot(prevalence_AgeSex["instances_boys",], main = "Number of boys per age")
barplot(diff(prevalence_AgeSex["instances_girls",]), main="Differences in N with age (girls)") #??
# Is it normal that there are incrementally more observations as age increases??
# Is it normal there are so few observations of the youngest age group?
barplot(prevalence_AgeSex["instances_girls",], main="Number of girls per age")
source("prevalence_calc.R")
# alternatively, feeding the data directory irectly to the function:
prevalence_calc(NCMP_data = read.csv("../ncmp_1819_final_non_disclosive_published.csv"), end_year = 2019)
